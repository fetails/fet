<!DOCTYPE html>
<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
        <script src="js/jquery.min.js"></script>
        <script src="js/dat.gui.min.js"></script>
        <script src="js/stats.min.js"></script>
        <title>WebGL &bull; Achi</title>
    </head>
    <body>
        <style>
            body, html {
                background-color: #161616;
                font-family: 'Lato', sans-serif;
                margin:0;
                padding:0;
            }
            canvas {
                display:block;
                width:100%;
                height:100vh;
            }

        </style>
        <canvas id="webglex" width="1920" height="1080"></canvas>
        <script src="js/gl-matrix.js"></script>
        <script src="js/achi.js"></script>
        <script type="text/javascript">

        var stats = new Stats();
        stats.showPanel( 0 ); // 0: fps, 1: ms, 2: mb, 3+: custom
        document.body.appendChild( stats.dom );
        
        // ====== Setup canvas gl. ====== //
        let canvas = document.querySelector("#webglex");
        let ogl = canvas.getContext("webgl2");
        if(!ogl)
        {
            alert("Your browser does not support WebGL 2");
        }

        let vdata = 
        "#version 300 es\n\n" +
        
        "in vec3 coords;\n" +
        "out vec4 sent_coords;\n\n" +
        
        "uniform mat4 ortho_matrix;\n" +

        "void main() {\n" + 
        " gl_Position = ortho_matrix * vec4(coords, 1.0);\n" +
        " sent_coords = gl_Position;\n" +
        "}";

        let fdata =
        "#version 300 es\n\n" +
        "precision mediump float;\n\n" +

        "out vec4 color;\n" +
        "in vec4 sent_coords;\n" +
        "void main() {\n" +
        " color = vec4(sent_coords.x + 0.25, sent_coords.y + 0.25, 0.50, 1);\n" +
        "}";

        let cfg = new AchiConfig();
        let shader = new AchiShader(vdata, fdata);
        let render = new Achi(ogl);

        // Render's the GUI (Dat GUI)
        render.gui();

        // Clear's the screen.
        render.clear();

        let quad_width = 500;
        let quad_height = 500;
        // Add's a new buffer to the VBO.
        render.quad(canvas.width / 2 - ( quad_width / 2), canvas.height / 2 - ( quad_height / 2 ), quad_width, quad_height);
        
        render.create();
        render.begin();
        shader.bind();

        let ortho_matrix = glMatrix.mat4.create();
        glMatrix.mat4.ortho(ortho_matrix, 0, canvas.width, canvas.height, 0, -1, 1000);

        shader.uniform_matrix4f("ortho_matrix", ortho_matrix);
        let loop = function(time)
        {
            render.clear();
            render.render();
            requestAnimationFrame( loop );
        };

        loop( 0 );

        </script>
    </body>
</html>